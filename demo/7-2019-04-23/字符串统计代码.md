# 字符串统计代码实现

## 概述

本文档提供了统计某一字符或字符串在另一个字符串中出现次数的代码实现，包含多种编程语言的版本。

## JavaScript 实现

### 方法一：使用 split() 方法

```javascript
function countOccurrences(str, searchStr) {
  // 使用 split 方法，分割后的数组长度减1就是出现次数
  return str.split(searchStr).length - 1;
}

// 示例使用
const text = "hello world, hello javascript, hello programming";
const searchWord = "hello";
console.log(`"${searchWord}" 出现了 ${countOccurrences(text, searchWord)} 次`);
// 输出: "hello" 出现了 3 次
```

### 方法二：使用正则表达式

```javascript
function countOccurrencesRegex(str, searchStr) {
  // 转义特殊字符，创建全局匹配的正则表达式
  const escapedSearchStr = searchStr.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  const regex = new RegExp(escapedSearchStr, "g");
  const matches = str.match(regex);
  return matches ? matches.length : 0;
}

// 示例使用
const text = "JavaScript is great! I love JavaScript.";
const searchWord = "JavaScript";
console.log(
  `"${searchWord}" 出现了 ${countOccurrencesRegex(text, searchWord)} 次`
);
// 输出: "JavaScript" 出现了 2 次
```

### 方法三：使用循环遍历

```javascript
function countOccurrencesLoop(str, searchStr) {
  let count = 0;
  let position = 0;

  while ((position = str.indexOf(searchStr, position)) !== -1) {
    count++;
    position += searchStr.length;
  }

  return count;
}

// 示例使用
const text = "abcabcabc";
const searchStr = "abc";
console.log(
  `"${searchStr}" 出现了 ${countOccurrencesLoop(text, searchStr)} 次`
);
// 输出: "abc" 出现了 3 次
```

### 方法四：统计单个字符（优化版）

```javascript
function countCharacter(str, char) {
  // 专门用于统计单个字符的优化方法
  let count = 0;
  for (let i = 0; i < str.length; i++) {
    if (str[i] === char) {
      count++;
    }
  }
  return count;
}

// 示例使用
const text = "programming";
const char = "m";
console.log(`字符 "${char}" 出现了 ${countCharacter(text, char)} 次`);
// 输出: 字符 "m" 出现了 2 次
```

## Python 实现

### 方法一：使用内置 count() 方法

```python
def count_occurrences_builtin(text, search_str):
    """使用 Python 内置的 count() 方法"""
    return text.count(search_str)

# 示例使用
text = "python is awesome, python is powerful"
search_word = "python"
result = count_occurrences_builtin(text, search_word)
print(f'"{search_word}" 出现了 {result} 次')
# 输出: "python" 出现了 2 次
```

### 方法二：使用正则表达式

```python
import re

def count_occurrences_regex(text, search_str):
    """使用正则表达式统计出现次数"""
    # 转义特殊字符
    escaped_search_str = re.escape(search_str)
    pattern = re.compile(escaped_search_str)
    return len(pattern.findall(text))

# 示例使用
text = "Hello world! Hello Python! Hello everyone!"
search_word = "Hello"
result = count_occurrences_regex(text, search_word)
print(f'"{search_word}" 出现了 {result} 次')
# 输出: "Hello" 出现了 3 次
```

### 方法三：使用循环实现

```python
def count_occurrences_loop(text, search_str):
    """使用循环遍历的方式统计"""
    count = 0
    start = 0

    while True:
        pos = text.find(search_str, start)
        if pos == -1:
            break
        count += 1
        start = pos + len(search_str)

    return count

# 示例使用
text = "abababab"
search_str = "ab"
result = count_occurrences_loop(text, search_str)
print(f'"{search_str}" 出现了 {result} 次')
# 输出: "ab" 出现了 4 次
```

### 方法四：忽略大小写的统计

```python
def count_occurrences_case_insensitive(text, search_str):
    """忽略大小写的统计"""
    return text.lower().count(search_str.lower())

# 示例使用
text = "Java is great! I love JAVA and java programming."
search_word = "java"
result = count_occurrences_case_insensitive(text, search_word)
print(f'"{search_word}" (忽略大小写) 出现了 {result} 次')
# 输出: "java" (忽略大小写) 出现了 3 次
```

## Java 实现

### 方法一：使用 String 的 split() 方法

```java
public class StringCounter {

    public static int countOccurrences(String text, String searchStr) {
        if (text == null || searchStr == null || searchStr.isEmpty()) {
            return 0;
        }

        // 使用 split 方法
        String[] parts = text.split(java.util.regex.Pattern.quote(searchStr), -1);
        return parts.length - 1;
    }

    public static void main(String[] args) {
        String text = "Java is powerful, Java is popular";
        String searchWord = "Java";
        int count = countOccurrences(text, searchWord);
        System.out.println("\"" + searchWord + "\" 出现了 " + count + " 次");
        // 输出: "Java" 出现了 2 次
    }
}
```

### 方法二：使用循环和 indexOf()

```java
public static int countOccurrencesLoop(String text, String searchStr) {
    if (text == null || searchStr == null || searchStr.isEmpty()) {
        return 0;
    }

    int count = 0;
    int index = 0;

    while ((index = text.indexOf(searchStr, index)) != -1) {
        count++;
        index += searchStr.length();
    }

    return count;
}

// 示例使用
String text = "hello world hello java hello programming";
String searchWord = "hello";
int count = countOccurrencesLoop(text, searchWord);
System.out.println("\"" + searchWord + "\" 出现了 " + count + " 次");
// 输出: "hello" 出现了 3 次
```

### 方法三：使用正则表达式

```java
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public static int countOccurrencesRegex(String text, String searchStr) {
    if (text == null || searchStr == null || searchStr.isEmpty()) {
        return 0;
    }

    // 转义特殊字符
    String escapedSearchStr = Pattern.quote(searchStr);
    Pattern pattern = Pattern.compile(escapedSearchStr);
    Matcher matcher = pattern.matcher(text);

    int count = 0;
    while (matcher.find()) {
        count++;
    }

    return count;
}
```

## C# 实现

### 方法一：使用 Split() 方法

```csharp
using System;

public class StringCounter
{
    public static int CountOccurrences(string text, string searchStr)
    {
        if (string.IsNullOrEmpty(text) || string.IsNullOrEmpty(searchStr))
            return 0;

        return text.Split(new string[] { searchStr }, StringSplitOptions.None).Length - 1;
    }

    static void Main()
    {
        string text = "C# is great! I love C# programming.";
        string searchWord = "C#";
        int count = CountOccurrences(text, searchWord);
        Console.WriteLine($"\"{searchWord}\" 出现了 {count} 次");
        // 输出: "C#" 出现了 2 次
    }
}
```

### 方法二：使用 IndexOf() 循环

```csharp
public static int CountOccurrencesLoop(string text, string searchStr)
{
    if (string.IsNullOrEmpty(text) || string.IsNullOrEmpty(searchStr))
        return 0;

    int count = 0;
    int index = 0;

    while ((index = text.IndexOf(searchStr, index)) != -1)
    {
        count++;
        index += searchStr.Length;
    }

    return count;
}
```

## C++ 实现

### 使用 string::find() 方法

```cpp
#include <iostream>
#include <string>

int countOccurrences(const std::string& text, const std::string& searchStr) {
    if (searchStr.empty()) return 0;

    int count = 0;
    size_t pos = 0;

    while ((pos = text.find(searchStr, pos)) != std::string::npos) {
        count++;
        pos += searchStr.length();
    }

    return count;
}

int main() {
    std::string text = "C++ is powerful, C++ is efficient";
    std::string searchWord = "C++";
    int count = countOccurrences(text, searchWord);
    std::cout << "\"" << searchWord << "\" 出现了 " << count << " 次" << std::endl;
    // 输出: "C++" 出现了 2 次

    return 0;
}
```

## 高级功能实现

### JavaScript 高级版本（支持多种选项）

```javascript
class StringCounter {
  static count(text, searchStr, options = {}) {
    const {
      caseSensitive = true,
      wholeWord = false,
      overlapping = false,
    } = options;

    if (!text || !searchStr) return 0;

    let processedText = caseSensitive ? text : text.toLowerCase();
    let processedSearch = caseSensitive ? searchStr : searchStr.toLowerCase();

    if (wholeWord) {
      // 使用正则表达式匹配完整单词
      const escapedSearch = processedSearch.replace(
        /[.*+?^${}()|[\]\\]/g,
        "\\$&"
      );
      const regex = new RegExp(
        `\\b${escapedSearch}\\b`,
        caseSensitive ? "g" : "gi"
      );
      const matches = processedText.match(regex);
      return matches ? matches.length : 0;
    }

    let count = 0;
    let position = 0;
    const step = overlapping ? 1 : searchStr.length;

    while (
      (position = processedText.indexOf(processedSearch, position)) !== -1
    ) {
      count++;
      position += step;
    }

    return count;
  }
}

// 示例使用
const text = "The cat in the hat sat on the mat";

console.log("基本统计:", StringCounter.count(text, "at"));
console.log("完整单词:", StringCounter.count(text, "at", { wholeWord: true }));
console.log(
  "忽略大小写:",
  StringCounter.count(text, "THE", { caseSensitive: false })
);
console.log(
  "重叠匹配:",
  StringCounter.count("aaa", "aa", { overlapping: true })
);
```

### Python 高级版本（支持多种模式）

```python
import re
from typing import Optional

class StringCounter:
    @staticmethod
    def count(text: str, search_str: str,
              case_sensitive: bool = True,
              whole_word: bool = False,
              overlapping: bool = False) -> int:
        """
        高级字符串统计功能

        Args:
            text: 要搜索的文本
            search_str: 要查找的字符串
            case_sensitive: 是否区分大小写
            whole_word: 是否只匹配完整单词
            overlapping: 是否允许重叠匹配

        Returns:
            出现次数
        """
        if not text or not search_str:
            return 0

        flags = 0 if case_sensitive else re.IGNORECASE

        if whole_word:
            # 使用正则表达式匹配完整单词
            pattern = r'\b' + re.escape(search_str) + r'\b'
            return len(re.findall(pattern, text, flags))

        if not overlapping:
            # 非重叠匹配
            if case_sensitive:
                return text.count(search_str)
            else:
                return text.lower().count(search_str.lower())
        else:
            # 重叠匹配
            count = 0
            start = 0
            search_text = text if case_sensitive else text.lower()
            search_target = search_str if case_sensitive else search_str.lower()

            while True:
                pos = search_text.find(search_target, start)
                if pos == -1:
                    break
                count += 1
                start = pos + 1  # 移动一个字符位置以允许重叠

            return count

# 示例使用
text = "The cat in the hat sat on the mat"

print('基本统计:', StringCounter.count(text, "at"))
print('完整单词:', StringCounter.count(text, "at", whole_word=True))
print('忽略大小写:', StringCounter.count(text, "THE", case_sensitive=False))
print('重叠匹配:', StringCounter.count("aaa", "aa", overlapping=True))
```

## 性能比较

### JavaScript 性能测试

```javascript
function performanceTest() {
  const text = "a".repeat(1000000) + "test".repeat(10000) + "b".repeat(1000000);
  const searchStr = "test";

  console.time("split方法");
  countOccurrences(text, searchStr);
  console.timeEnd("split方法");

  console.time("正则表达式");
  countOccurrencesRegex(text, searchStr);
  console.timeEnd("正则表达式");

  console.time("循环方法");
  countOccurrencesLoop(text, searchStr);
  console.timeEnd("循环方法");
}

// performanceTest();
```

## 使用建议

### 选择合适的方法

1. **简单场景**：使用内置方法（如 Python 的 `count()`，JavaScript 的 `split()`）
2. **性能要求高**：使用循环遍历方法
3. **复杂匹配**：使用正则表达式
4. **大文本处理**：考虑使用流式处理或分块处理

### 注意事项

1. **空字符串处理**：确保处理空字符串的边界情况
2. **特殊字符**：在正则表达式中需要转义特殊字符
3. **性能考虑**：对于大文本，选择合适的算法
4. **内存使用**：避免创建不必要的中间字符串

## 总结

本文档提供了多种编程语言中统计字符串出现次数的实现方法，每种方法都有其适用场景。在实际开发中，应根据具体需求选择最合适的实现方式。
