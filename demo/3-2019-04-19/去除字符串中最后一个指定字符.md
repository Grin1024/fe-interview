# 去除字符串中最后一个指定字符

## 问题描述

如何去除字符串中最后一个指定的字符？这是一个常见的 JavaScript 字符串处理问题。

## 解决方案

### 方法 1: 使用 `lastIndexOf()` + `substring()`

```javascript
function removeLastChar(str, char) {
  const lastIndex = str.lastIndexOf(char);
  if (lastIndex === -1) {
    return str; // 如果没有找到指定字符，返回原字符串
  }
  return str.substring(0, lastIndex) + str.substring(lastIndex + 1);
}
```

**优点：**

- 代码简洁易懂
- 性能较好
- 兼容性好

**原理：**

1. 使用 `lastIndexOf()` 找到指定字符最后一次出现的位置
2. 使用 `substring()` 分别获取该位置前后的字符串
3. 拼接前后两部分，跳过要删除的字符

### 方法 2: 使用 `lastIndexOf()` + `slice()`

```javascript
function removeLastChar(str, char) {
  const lastIndex = str.lastIndexOf(char);
  if (lastIndex === -1) {
    return str;
  }
  return str.slice(0, lastIndex) + str.slice(lastIndex + 1);
}
```

**优点：**

- 与方法 1 类似，但使用 `slice()` 方法
- 支持负数索引（虽然这里用不到）

### 方法 3: 使用正则表达式

```javascript
function removeLastChar(str, char) {
  // 转义特殊正则字符
  const escapedChar = char.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");

  // 使用正向先行断言，匹配最后一个指定字符
  const regex = new RegExp(`${escapedChar}(?!.*${escapedChar})`);

  return str.replace(regex, "");
}
```

**优点：**

- 一行代码解决问题
- 支持复杂的匹配模式

**缺点：**

- 性能相对较差
- 需要处理特殊正则字符的转义

**原理：**

- `(?!.*${escapedChar})` 是正向先行断言，表示后面不再有该字符
- 这样就能匹配到最后一个指定字符

### 方法 4: 使用循环从后往前查找

```javascript
function removeLastChar(str, char) {
  for (let i = str.length - 1; i >= 0; i--) {
    if (str[i] === char) {
      return str.slice(0, i) + str.slice(i + 1);
    }
  }
  return str; // 没有找到指定字符
}
```

**优点：**

- 逻辑清晰
- 可以很容易地扩展为删除多个字符

**缺点：**

- 代码相对冗长
- 性能不如内置方法

### 方法 5: 使用数组反转（不推荐）

```javascript
function removeLastChar(str, char) {
  const arr = str.split("");
  const reversedArr = arr.reverse();

  const index = reversedArr.indexOf(char);
  if (index === -1) {
    return str;
  }

  reversedArr.splice(index, 1);
  return reversedArr.reverse().join("");
}
```

**缺点：**

- 性能差，需要多次数组操作
- 代码复杂
- 不推荐使用

## 性能对比

根据测试结果（执行 10000 次）：

1. **lastIndexOf + slice** - 最快
2. **lastIndexOf + substring** - 很快
3. **循环查找** - 中等
4. **正则表达式** - 较慢
5. **数组反转** - 最慢

## 使用示例

```javascript
// 示例1: 删除最后一个字母
console.log(removeLastChar("hello world", "l")); // "hello word"

// 示例2: 删除重复字符中的最后一个
console.log(removeLastChar("programming", "m")); // "programing"

// 示例3: 字符不存在的情况
console.log(removeLastChar("javascript", "z")); // "javascript"

// 示例4: 删除最后一个数字
console.log(removeLastChar("abc123abc123", "3")); // "abc123abc12"

// 示例5: 空字符串
console.log(removeLastChar("", "a")); // ""

// 示例6: 只有一个字符
console.log(removeLastChar("a", "a")); // ""
```

## 扩展版本：删除多个字符

```javascript
function removeLastChars(str, chars) {
  const lastIndex = str.lastIndexOf(chars);
  if (lastIndex === -1) {
    return str;
  }
  return str.slice(0, lastIndex) + str.slice(lastIndex + chars.length);
}

// 示例
console.log(removeLastChars("hello world hello", "hello")); // "hello world "
console.log(removeLastChars("abcdefabcdef", "abc")); // "abcdefdef"
```

## 错误处理版本

```javascript
function removeLastCharSafe(str, char) {
  // 参数验证
  if (typeof str !== "string" || typeof char !== "string") {
    throw new Error("参数必须是字符串类型");
  }

  if (char.length !== 1) {
    throw new Error("要删除的字符必须是单个字符");
  }

  const lastIndex = str.lastIndexOf(char);
  if (lastIndex === -1) {
    return str;
  }

  return str.slice(0, lastIndex) + str.slice(lastIndex + 1);
}
```

## 推荐方案

**推荐使用方法 1 或方法 2**，因为：

1. **性能最佳** - 使用内置的字符串方法
2. **代码简洁** - 易于理解和维护
3. **兼容性好** - 所有现代浏览器都支持
4. **可靠性高** - 经过充分测试的内置方法

## 注意事项

1. **空字符串处理** - 确保正确处理空字符串的情况
2. **字符不存在** - 当指定字符不存在时，应返回原字符串
3. **特殊字符** - 如果使用正则表达式方法，需要转义特殊字符
4. **性能考虑** - 对于大量数据处理，选择性能最佳的方法
5. **参数验证** - 在生产环境中建议添加参数类型检查

## 测试用例

```javascript
// 测试用例
const testCases = [
  { str: "hello world", char: "l", expected: "hello word" },
  { str: "javascript", char: "a", expected: "jvascript" },
  { str: "programming", char: "m", expected: "programing" },
  { str: "test", char: "x", expected: "test" },
  { str: "aaaaaa", char: "a", expected: "aaaaa" },
  { str: "", char: "a", expected: "" },
  { str: "single", char: "s", expected: "ingle" },
];

// 运行测试
testCases.forEach((testCase, index) => {
  const result = removeLastChar(testCase.str, testCase.char);
  const passed = result === testCase.expected;
  console.log(
    `测试 ${index + 1}: ${passed ? "✓" : "✗"} "${testCase.str}" -> "${result}"`
  );
});
```
