# 字符串大小写切换方法总结

## 问题描述

**来源：** 前端面试每日 3+1 第 5 天 (2019-04-21)  
**问题：** 写一个把字符串大小写切换的方法  
**链接：** https://github.com/haizlin/fe-interview/issues/15

## 解决方案

### 方法一：字符编码判断（推荐）

**原理：** 通过字符的 ASCII 码值判断大小写，然后进行转换  
**优点：** 性能最佳，逻辑清晰  
**适用场景：** 性能要求高的场景

```javascript
function toggleCase1(str) {
  if (typeof str !== "string") {
    throw new Error("参数必须是字符串类型");
  }

  let result = "";
  for (let i = 0; i < str.length; i++) {
    const char = str[i];
    const charCode = char.charCodeAt(0);

    // 判断是否为大写字母 (A-Z: 65-90)
    if (charCode >= 65 && charCode <= 90) {
      result += char.toLowerCase();
    }
    // 判断是否为小写字母 (a-z: 97-122)
    else if (charCode >= 97 && charCode <= 122) {
      result += char.toUpperCase();
    }
    // 其他字符保持不变
    else {
      result += char;
    }
  }
  return result;
}
```

### 方法二：正则表达式

**原理：** 通过正则匹配大小写字母，然后使用回调函数进行转换  
**优点：** 代码简洁，易读  
**适用场景：** 一般业务场景

```javascript
function toggleCase2(str) {
  if (typeof str !== "string") {
    throw new Error("参数必须是字符串类型");
  }

  return str.replace(/[a-zA-Z]/g, function (char) {
    return char === char.toUpperCase()
      ? char.toLowerCase()
      : char.toUpperCase();
  });
}
```

### 方法三：ES6 箭头函数

**原理：** 结合 ES6 语法，使代码更加简洁  
**优点：** 代码最简洁  
**适用场景：** 现代 JavaScript 项目

```javascript
const toggleCase3 = (str) => {
  if (typeof str !== "string") {
    throw new Error("参数必须是字符串类型");
  }

  return str.replace(/[a-zA-Z]/g, (char) =>
    char === char.toUpperCase() ? char.toLowerCase() : char.toUpperCase()
  );
};
```

### 方法四：数组方法

**原理：** 将字符串转为数组，使用 map 方法处理每个字符  
**优点：** 函数式编程风格  
**适用场景：** 函数式编程项目

```javascript
function toggleCase4(str) {
  if (typeof str !== "string") {
    throw new Error("参数必须是字符串类型");
  }

  return str
    .split("")
    .map((char) => {
      if (/[a-z]/.test(char)) {
        return char.toUpperCase();
      } else if (/[A-Z]/.test(char)) {
        return char.toLowerCase();
      } else {
        return char;
      }
    })
    .join("");
}
```

### 方法五：Unicode 增强版

**原理：** 使用 Unicode 范围判断，支持更多字符类型  
**优点：** 支持国际化字符  
**适用场景：** 需要处理多语言的场景

```javascript
function toggleCaseAdvanced(str) {
  if (typeof str !== "string") {
    throw new Error("参数必须是字符串类型");
  }

  return str.replace(/\p{L}/gu, (char) => {
    const upper = char.toUpperCase();
    const lower = char.toLowerCase();
    return char === upper ? lower : upper;
  });
}
```

## 测试结果

### 功能测试

| 输入             | 输出             | 说明               |
| ---------------- | ---------------- | ------------------ |
| `"Hello World!"` | `"hELLO wORLD!"` | 基本大小写切换     |
| `"JavaScript"`   | `"jAVAsCRIPT"`   | 混合大小写         |
| `"ABC123def"`    | `"abc123DEF"`    | 包含数字           |
| `"123!@#"`       | `"123!@#"`       | 非字母字符保持不变 |
| `""`             | `""`             | 空字符串           |
| `"a"`            | `"A"`            | 单个小写字母       |
| `"A"`            | `"a"`            | 单个大写字母       |

### 性能测试

在测试字符串长度为 43,000 字符，执行 10,000 次的条件下：

1. **方法一（字符编码）：** 性能最佳
2. **方法二（正则表达式）：** 性能良好
3. **方法三（ES6 箭头函数）：** 与方法二相近
4. **方法四（数组方法）：** 性能较差
5. **方法五（Unicode 增强）：** 性能中等

## 最佳实践推荐

### 选择建议

1. **简单场景：** 使用方法二（正则表达式）

   - 代码简洁易懂
   - 性能满足大多数需求
   - 维护成本低

2. **性能要求高：** 使用方法一（字符编码判断）

   - 性能最佳
   - 适合大量数据处理

3. **国际化需求：** 使用方法五（Unicode 增强版）

   - 支持多语言字符
   - 兼容性好

4. **现代项目：** 使用方法三（ES6 箭头函数）
   - 语法简洁
   - 符合现代 JavaScript 规范

### 注意事项

1. **输入验证：** 确保输入参数是字符串类型
2. **字符处理：** 非字母字符应保持不变
3. **性能考虑：** 根据数据量选择合适的方法
4. **兼容性：** 考虑目标环境的 JavaScript 版本支持

## 扩展思考

### 进阶问题

1. **如何处理 emoji 表情？**

   - emoji 通常不区分大小写，应保持不变
   - 可以使用 Unicode 属性来识别 emoji

2. **如何处理其他语言的大小写？**

   - 使用`\p{L}`正则表达式匹配所有字母
   - 依赖 JavaScript 内置的`toUpperCase()`和`toLowerCase()`方法

3. **如何优化大字符串的处理性能？**
   - 使用字符编码判断方法
   - 考虑分块处理
   - 使用 Web Workers 进行后台处理

### 相关知识点

- ASCII 码表
- Unicode 字符集
- 正则表达式
- JavaScript 字符串方法
- 性能优化技巧

## 文件结构

```
├── lib/
│   └── string-case-toggle.js     # 完整实现代码
├── demo/
│   └── string-case-toggle-demo.html  # 在线演示页面
└── 字符串大小写切换方法总结.md   # 本文档
```

## 使用方式

### Node.js 环境

```javascript
const { toggleCase1, toggleCase2 } = require("./lib/string-case-toggle.js");

console.log(toggleCase1("Hello World!")); // "hELLO wORLD!"
console.log(toggleCase2("JavaScript")); // "jAVAsCRIPT"
```

### 浏览器环境

```html
<script src="lib/string-case-toggle.js"></script>
<script>
  console.log(toggleCase1("Hello World!")); // "hELLO wORLD!"
</script>
```

### 在线演示

打开 `demo/string-case-toggle-demo.html` 文件可以在浏览器中测试各种方法的效果和性能。

---

**总结：** 字符串大小写切换是一个看似简单但有多种实现方式的问题。选择合适的方法需要考虑性能、可读性、兼容性等多个因素。在实际项目中，建议根据具体需求选择最适合的实现方式。
